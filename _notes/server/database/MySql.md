MySQL
==============

# install MySQL
  $ brew install mysql
  $ gem install mysql2 -v '<version>'
  $ mysql.server start
  $ mysql.server stop

  for bindo

  1. first you need to create new database in your mysql client, say "bindo_dev" and "bindo_gateway_dev"
  2. then run the following commands in command line:
     gunzip < bindo_dev.20140802.sql.gz | mysql -uroot bindo_dev
     gunzip < bindo_gateway_dev.20140802.sql.gz | mysql -uroot bindo_gateway_dev
     to unzip the files and "stream" them to your newly created DBs
  3. for easier development, you may set root user to no password

# create a database
  1. enter SQL console
  $ mysql -u root -p <database name>(here is no -p so there is no password set for this account) 
  $ SET PASSWORD = PASSWORD('<password>');
  2. create database 
  $ create database xxxx
  3. show databases
  $ show databases
  4. drop database
  $ DROP DATABASE <db name>

# importing and exporting
  Exporting:
  1. mysqldump -u user -p database | gzip > database.sql.gz
  Importing:
  2. gunzip < database.sql.gz | mysql -u user -p database

  Or
  $ mysql -u(username) (db name) < (unzipped filename)
    mysql -u root -p bindo_dev < bindo_20150315.sql
    mysql -u root -p bindo_gateway_dev < gateway_20150315.sql

  (using the terminal to import or might have some upexpected problems)

# for bindo gateway
  "rackup" or "bundle exec unicorn"

  ?? How to configure RACK_ENV

# BindoGateway configuration
  1. config/site.yml
  2. in development section, change all URL to the trybindo one
     i.e. bindo, data_center, oauth
     decryptor may change too
     just copy "dev" section
  3. then restart gateway server and see

#  ERROR! MySQL server PID file could not be found!
   1. $ df -h
   disk filesystem -> df
   Using '-h' parameter will shows the file system disk space statistics in 'human readable' format, means it gives the details in bytes, mega bytes and gigabyte.

   I eventually went over to the activity monitor in my Mac, force Quit the PID. the 
   $ mysql.server start

# Sinatra BindoGateway create test database
  1. select a database
     $ USE xxxx
  2. show tables
     $ SHOW tables

  After create the database:
  RACK_ENV=test rake db:migrate

# ERROR! Mysql2::Error: Access denied for user 'root'@'localhost' (using password: NO)

# Locally mysql port is 3306

# $ SHOW GRANTS FOR 'root'@'localhost' (in mysql console)
  mysql > grant all on db_name.* to 'db_user'@'localhost' identified by 'db_password';

# query cache
  The query cache stores the text of a SELECT statement together with the corresponding result that was sent to the client. If an identical statement is received later, the server retrieves the results from the query cache rather than parsing and executing the statement again. The query cache is shared among sessions, so a result set generated by one client can be sent in response to the same query issued by another client.

  The query cache can be useful in an environment where you have tables that do not change very often and for which the server receives many identical queries. This is a typical situation for many Web servers that generate many dynamic pages based on database content.

  The query cache does not return stale data. When tables are modified, any relevant entries in the query cache are flushed.

# $mysql 
  mysql> show databases;
  mysql> use bindo_gateway_dev;
  mysql> show create table transactions;
  mysql> use bindo_dev;
  mysql> show create table oauth2_authorizations;
  mysql> select * from oauth2_authorizations limit 5;
  mysql> desc serial_numbers;  // show table information

# ssl
  http://www.tldp.org/HOWTO/SSL-Certificates-HOWTO/index.html

  https://dev.mysql.com/doc/refman/5.0/en/creating-ssl-files-using-openssl.html 
  https://dev.mysql.com/doc/refman/5.0/en/using-ssl-connections.html

  http://www.akadia.com/services/ssh_test_certificate.html

  https://www.percona.com/blog/2013/06/22/setting-up-mysql-ssl-and-secure-connections/ 

  $ mysql> \s; // show the server information
  $ mysql> show variables like '%ssl%'

# $ mysqld restart
  
# $ mysql> DESCRIBE <table name>;

# Backing Up and Restoring
  1. The main drawback is that you must make sure that no one writes to a table while you're backing it up using `mysqldump`.
     There are various ways to do this, but the easiest is to shut down the MySQL server before mysqldump and start up the server again after mysqldump finishes.
     Or you can lock the tables you are backing up before running mysqldump.
     $ mysql > LOCK TABLES tablename1 READ, tablename2 READ ...
     // do mysqldump 
     $ mysqldump -u user -ppassword database  // make sure that mysqldump is in your path, or that you specify its location as part of your command.(/Applications/xampp/bin)
     $ mysql > UNLOCK TABLES;

  2. you can send the backup data directly to a file using the > redirect symbol.
     $ mysqldump -u user -p password publications > publication.sql 

  3. Backing up a single table 
     $ mysql > LOCK TABLES publications.classics READ; // readonly
     $ mysqldump -u user -ppassword publications classics > classics.sql 
     $ mysql > UNLOCK TABLES;

  4. Backing up all tables 
     $ mysqldump -u user -ppassword --all-databases > all_databases.sql 

  5. restoring from a Backup File 
     $ mysql -u user -ppassword < all_databases.sql 
     $ mysql -u user -ppassword -D publications < publications.sql // use the -D option followed by the name of the database 
     $ mysql -u user -ppassword -D publications < classics.sql

  6. Dumping data in CSV format 
     $ mysqldump -u user -ppassword --no-create-info --tab=c:/temp --fields-terminated-by=',' publications 


#placeholder
  PREPARE statement FROM "INSERT INTO classics VALUES(?,?,?,?,?)";
SET @author   = "Emily BronteÌˆ",
    @title    = "Wuthering Heights",
    @category = "Classic Fiction",
    @year     = "1847",
    @isbn     = "9780553212587";
EXECUTE statement USING @author,@title,@category,@year,@isbn;
DEALLOCATE PREPARE statement;

# support chinese
  http://www.somacon.com/p580.php 

  mysql> set global collation_connection=utf8_general_ci

  http://makandracards.com/makandra/2529-show-and-change-mysql-default-character-set

# init database password and security: 
  $ mysql_secure_installation

# for homebrew mysql 
  ln -s /var/mysql/mysql.sock /tmp/mysql.sock 

  mysqld --help --verbose
  If the homebrew mysql need to be update config : mysql.cnf 
  $ cp $(brew --prefix mysql)/support-files/my-default.cnf /usr/local/etc/my.cnf

# cannot connect to database with standard way: 

http://stackoverflow.com/questions/26538112/mysql-running-but-cannot-connect-to-127-0-0-1/26543260#26543260

  
bind-address           =  127.0.0.1

# FORCE INDEX

# find the encoding information
  $ SELECT DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME = 'db_name';
   










